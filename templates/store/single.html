{% extends "../base.html" %}
{% load static %} 
{% block stylesheet %}{% static 'store/css/store.css' %}{% endblock %}
{% block title %}
{% if product %}{{ product.title }}{% else %}Product{% endif %}
{% endblock %}
{% block content %}

<div class="container">
  <div class="row g-3">
    <div class="col-md-5 ps-3 col-lg-5 order-md-last p-0 order-1">
      <div class="d-grid gap-2">
        <div class="d-flex d-flex-inline justify-content-between">
          <div><span class="h3">Â£{{ product.regular_price }}</span>
            <p class="text-muted">includes tax</p>
          </div>
          <div>
            <label for="select">Qty</label>
            <select id="select" class="h6 store-select-dropdown">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
            </select>
          </div>
        </div>
        <hr>
        <button type="button" id="add-button" value="{{product.id}}" class="btn btn-success fw500">Add to
          basket</button>
        <button type="button" id="add-button" value="{{product.id}}" class="btn btn-light fw500">Add to
          Favorites</button>
      </div>
    </div>
    <div class="col-md-7 col-lg-7 p-0">
      <div class="card mb-3 border-0">
        <div class="row g-0">
          <div class="col-md-12">
            <div class="card-body p-1">
              <h1 class="mb-0 h2 pe-4 pb-4">{{ product.title }}</h1>
              {% comment %} foreign key related name(product_image) mentioned in product {% endcomment %}
              {% for image in product.product_image.all %}
                {% if image.is_feature %}
                  <img class="img-fluid mx-auto d-block" width="200px" alt="Responsive image" src="{{ image.image.url }}" alt="{{ image.image.alt_text }}">
                {% else %}
                  <img class="img-fluid d-block-inline pt-3" width="100px" alt="Responsive image" src="{{ image.image.url }}" alt="{{ image.image.alt_text }}">
                {% endif %}
              {% endfor %}    
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- when we presses the button will collect the product id, it will send to server in backend it wil fetch the product information and 
also it will update the session data corresponding with product data ajax JQUERY-->

<!--    add-button is the id and val is nothing but the product id function(e) is event which is clicking -->
<!--    xhr- XMLHttpRequest --> -->

<!-- inorder to avoid the refreshing the page after update/delete we use jquery to automatically update the page -->
<!-- in json.qty is nothing but from views -->


<!-- on click find the id i.e,., now again ajax will be there to add backend to front end 
there we mentioning the post type and url and data with productid i.e., id="add-button" and .value -->

<script>
  $(document).on('click', '#add-button', function (e) {
    e.preventDefault();

    $.ajax({
      type: 'POST',
      url: '{% url "basket:basket_add" %}',
      data: {
        productid: $('#add-button').val(),
        productqty: $('#select option:selected').text(),
        csrfmiddlewaretoken: "{{csrf_token}}",
        action: 'post'
      },
      success: function (json) {
        document.getElementById("basket-qty").innerHTML = json.qty


      },

      error: function (xhr, errmsg, err) {}
    });
  })
</script>

{% endblock %}